doctype html
html
	head
		title Miaou - Room Edition
		link(rel="icon",type="image/png",href="static/M-32.png")
		link(rel='stylesheet', href='static/main.css')
		script(src="static/jquery-2.0.3.min.js")
		script(src="static/miaou.min.js")
		style.
			#roomdescription {
				padding: 2px;
				background: #F0EAD6;
			}
	body.home
		section#hometop
			div.thinMP
				a(href='.')
					img(src="static/Miaou-300-f.png")
		section#homenotifs
			div.thinMP
				h2 Room Edition
		section#homemain
			div.thinMP
				form(method="post")
					input#id(type="hidden", name="id")
					table.form
						tr
							th Name
							td
								input#name(type="text", name="name", value=suggestedName, pattern=".{2,50}")
						tr
							th Privacy
							td
								select#private(name="private")
									option(value="on") Private Room
									option(value="off") Public Room
						tr
							th Listings
							td
								select#listed(name="listed")
									option(value="on") Listed Room
									option(value="off") Discrete Room
						tr
							th Language
							td
								select#lang(name="lang")
						tr
							th Description
							td
								textarea#description(name="description")
						tr
							td Description Preview
							td
								div.rendered.input#roomdescription
					p#err.error
					div.dialog_buttons
						input#cancel(type='button', value='Cancel')
						input(type='submit', value='Save')#submit
		
		script.
			var langs = !{langs};
			for (var key in langs) {
				var lang = langs[key];
				$('#lang').append($('<option>').attr('value', key).text(lang.name));
			}
			var room = !{room}, error=!{error};
			if (room) {
				$('.dialog_title').text('Room Edition');
				$('#name').val(room.name);
				$('#description').val(room.description);
				$('#private').val(room.private ? 'on' : 'off');
				$('#listed').val(room.listed ? 'on' : 'off');
				if (room.auth!=='own') $('#private').prop('disabled', true);
				$('#lang').val(room.lang || langs[0].key);
				$('#id').val(room.id);
			}
			if (error) {
				$('#err').text(error);
			}
			$('form')[0].action = location;
			$('#name').focus().keyup(function(){
				if (!this.validity.valid){
					$('#err').text('Please type a ' + (this.value.length>50 ? 'shorter' : 'prettier') + ' name');
					$('#submit').prop('disabled', true);
				} else {
					$('#err').text('');
					$('#submit').prop('disabled', false);
				}
			});
			$('#cancel').click(function(){ history.back() });
			function format(){
				$('#roomdescription').html(miaou.mdToHtml($('#description').val()));
			}
			$('#description').keyup(format);
			format();

